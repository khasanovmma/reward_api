# üèÜ Reward API

**Reward API** ‚Äî backend-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ Django, –ø–æ–∑–≤–æ–ª—è—é—â–µ–µ —É–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, –Ω–∞—á–∏—Å–ª—è—Ç—å –Ω–∞–≥—Ä–∞–¥—ã –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ —á–µ—Ä–µ–∑ Celery.

---

## üöÄ –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

- Django 4.2
- Django REST Framework
- PostgreSQL
- Redis
- Celery
- JWT (SimpleJWT)
- drf-spectacular (Swagger)
- Docker / Docker Compose

---

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### üê≥ –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker

1. –ö–ª–æ–Ω–∏—Ä—É–π –ø—Ä–æ–µ–∫—Ç:

```bash
git clone https://github.com/yourusername/reward-api.git
cd reward-api
```

2. –ó–∞–ø—É—Å–∫:

```bash
docker-compose up -d --build
```

3. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π:

```bash
docker-compose exec web python manage.py migrate
```

4. –°–æ–∑–¥–∞–Ω–∏–µ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø–æ –∂–µ–ª–∞–Ω–∏—é):

```bash
docker-compose exec web python manage.py createsuperuser
```

---

### üíª –ó–∞–ø—É—Å–∫ –≤—Ä—É—á–Ω—É—é (–±–µ–∑ Docker)

1. –ü–µ—Ä–µ–π–¥–∏ –≤ –ø–∞–ø–∫—É:

```bash
cd deployment/environment/
```

2. –°–∫–æ–ø–∏—Ä—É–π `.env.example`:

```bash
cp .env.example .env
```

3. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π `.env` –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `SECRET_KEY`, `DB` –∏ —Ç.–¥.)

4. –£—Å—Ç–∞–Ω–æ–≤–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```bash
pip install -r requirements.txt
```

5. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π:

```bash
python manage.py migrate
```

6. –ó–∞–ø—É—Å—Ç–∏ Redis (–µ—Å–ª–∏ –Ω–µ —á–µ—Ä–µ–∑ Docker):

```bash
docker run -d --name reward_api_redis -p 6379:6379 redis:7
```

7. –ó–∞–ø—É—Å—Ç–∏ Celery:

```bash
celery -A core worker -l info
```

8. –ó–∞–ø—É—Å—Ç–∏ Django-—Å–µ—Ä–≤–µ—Ä:

```bash
python manage.py runserver
```

---

## üîë –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

JWT-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:

| –ú–µ—Ç–æ–¥ | URL | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-------|-----|------------|
| POST | `/api/token/` | –ü–æ–ª—É—á–∏—Ç—å access/refresh —Ç–æ–∫–µ–Ω—ã |
| POST | `/api/token/refresh/` | –û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω |
| POST | `/api/token/verify/` | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–∫–µ–Ω |

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

| –ú–µ—Ç–æ–¥ | URL | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|-----|----------|
| `GET` | `/api/profile/` | –ü—Ä–æ—Ñ–∏–ª—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `GET` | `/api/rewards/` | –°–ø–∏—Å–æ–∫ –Ω–∞–≥—Ä–∞–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `POST` | `/api/rewards/request/` | –ó–∞–ø—Ä–æ—Å –Ω–∞–≥—Ä–∞–¥—ã (1 —Ä–∞–∑ –≤ –¥–µ–Ω—å, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç) |

---

## ‚è≥ Celery & –û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

–ú–æ–¥–µ–ª—å `ScheduledReward` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–π –Ω–∞–≥—Ä–∞–¥—ã, –∫–æ—Ç–æ—Ä–∞—è:

- –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –∑–∞–¥–∞–Ω–Ω–æ–µ `execute_at`
- –ù–∞—á–∏—Å–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é `coins`
- –õ–æ–≥–∏—Ä—É–µ—Ç –Ω–∞–≥—Ä–∞–¥—É –≤ `RewardLog`

Celery –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Redis –∫–∞–∫ –±—Ä–æ–∫–µ—Ä.

---

## üìò Swagger

–ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è API-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É:

```
/api/schema/swagger/
```

---

## ‚úÖ –¢–µ—Å—Ç—ã

```bash
python manage.py test
```

–¢–µ—Å—Ç–∏—Ä—É—é—Ç—Å—è:

- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (–ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞)
- –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–≥—Ä–∞–¥—ã —Ä–∞–∑ –≤ –¥–µ–Ω—å

---

## üìÑ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### üîÑ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `.env`

#### üìÅ –î–ª—è Docker:

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–∞–π–ª:
```
deployment/environment/.env
```

#### üíª –î–ª—è —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞:

1. –°–∫–æ–ø–∏—Ä—É–π `.env.example`:
```bash
cp deployment/environment/.env.example deployment/environment/.env
```

2. –ó–∞–ø–æ–ª–Ω–∏ –∑–Ω–∞—á–µ–Ω–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):
```env
POSTGRES_DB=rewarddb
POSTGRES_USER=rewarduser
POSTGRES_PASSWORD=rewardpass
SECRET_KEY=your_secret_key
DEBUG=True
```

---

## üõ† –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
docker-compose up --build       # –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–µ–∫—Ç
docker-compose exec web sh      # –ó–∞–π—Ç–∏ –≤–Ω—É—Ç—Ä—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker-compose exec web python manage.py migrate
docker-compose exec web python manage.py createsuperuser
```

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π MIT.
